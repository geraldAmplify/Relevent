<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta http-equiv="X-UA-Compatible" content="ie=edge">
	<title>Relevent Now</title>
	<!--Browser Icon-->
	<link rel="shortcut icon" type="image/jpg" href="https://png.icons8.com/windows/1600/elephant.png"/>
	<!--css stylesheet-->
	<link rel="stylesheet" href="css/releventApp.css">
	<!--Bootstrap Skin-->
	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootswatch/4.1.2/minty/bootstrap.min.css">
	<!--FontAwesome-->
	<script defer src="https://use.fontawesome.com/releases/v5.0.6/js/all.js"></script>
	<!-- jQuery library -->
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
	<!-- Popper JS -->
	<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.0/umd/popper.min.js"></script>
	<!-- Latest compiled JavaScript -->
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.0/js/bootstrap.min.js"></script>
	<!--js functions
	<script src="js/releventApp.js" type="text/javascript"></script>-->
	<script type="text/javascript" src="js/data.js"></script>
	
	<script>
    (function(h,o,t,j,a,r){
        h.hj=h.hj||function(){(h.hj.q=h.hj.q||[]).push(arguments)};
        h._hjSettings={hjid:916132,hjsv:6};
        a=o.getElementsByTagName('head')[0];
        r=o.createElement('script');r.async=1;
        r.src=t+h._hjSettings.hjid+j+h._hjSettings.hjsv;
        a.appendChild(r);
    })(window,document,'https://static.hotjar.com/c/hotjar-','.js?sv=');
	</script>
		<!-- Google Tag Manager -->
	<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
	new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
	j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
	'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
	})(window,document,'script','dataLayer','GTM-T32J3ZW');</script>
	<!-- End Google Tag Manager -->
		<!-- Facebook Pixel Code -->
	<script>
	  !function(f,b,e,v,n,t,s)
	  {if(f.fbq)return;n=f.fbq=function(){n.callMethod?
	  n.callMethod.apply(n,arguments):n.queue.push(arguments)};
	  if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
	  n.queue=[];t=b.createElement(e);t.async=!0;
	  t.src=v;s=b.getElementsByTagName(e)[0];
	  s.parentNode.insertBefore(t,s)}(window, document,'script',
	  'https://connect.facebook.net/en_US/fbevents.js');
	  fbq('init', '2264863760198190');
	  fbq('track', 'PageView');
	</script>
	<noscript><img height="1" width="1" style="display:none"
	  src="https://www.facebook.com/tr?id=2264863760198190&ev=PageView&noscript=1"
	/></noscript>
	<!-- End Facebook Pixel Code -->
</head>

<body>
	<div class="container-fluid" id="header">

	  	<div class="row" id="navigation">
	    	<div class="col-2" id="logoCol">
	      		<img id="logo-R" src="designAssets/Logo-Img-White.svg" height="100%">
	    	</div>
			<div class="col-8" id="searchBarCol">
	      		<form id="search-location-form">
	        		<input id="search-location" class="form-control form-control-sm" placeholder="Change my location" required/>
	        		<button id="search-location-btn" class="btn"><i class="fas fa-search"></i></button>
	      		</form>
    		</div>
    		<div class="col-2" id="weatherCol">
    			<button id="weather-btn" class="btn btn-warning"><img id="weather-icon" src="designAssets/weather-temp.png"></button>
    		</div>
  		</div>

	  	<div class="btn" id="settings">
			<button class="btn btn-info" id="categories">Event Type &nbsp;<img src="designAssets/DownArrow.png" height="6" width="9"></button>
			<button class="btn btn-info" id="ages">Ages &nbsp;<img src="designAssets/DownArrow.png" height="6" width="9"></button>
			<button class="btn btn-info" id="walk-time">Walk Time &nbsp;<img src="designAssets/DownArrow.png" height="6" width="9"></button>
			<button class="btn btn-info" id="features">More &nbsp;<img src="designAssets/DownArrow.png" height="6" width="9"></button>
	 	</div>
	  	
	</div>


	<!-- Onboarding Modal -->
	<div id="onboarding-layer">
		<div id="onboarding-modal">
			<span class='close' id='modal-close' onclick='hideModals()'>&times;</span>
			<br>
			<div class="onboarding-container">

				<div class="mySlides fade">
					<h4 id="onboarding-title">Welcome to Relevent</h4>
					<div style="display: flex">
			  			<img id="onboarding-img" src="designAssets/Illustration_Party_Elephant.svg" style="width:100%">
			  		</div>
			  		<div id="onboarding-text">Your one stop shop for fun family activities near you!</div>
			  		<button class='btn btn-secondary btn-block' id="get-started-1" onclick='getUserLocation();'>Find events near me</button>
			  		<button class='btn btn-secondary btn-block' id="get-started-2" onclick='getSearchLocation();'>Search an area for events</button>
				</div>

			</div>
		</div>
	</div>
	<!-- Category Tip Modal -->
	<div id="categoryTip-layer">
		<div id="categoryTip-modal">
			<br>
			<div class="categoryTip-container">

				<div class="mySlides fade">
					<h4 id="categoryTip-title">Find Relevant Activities</h4>
					<div style="display: flex">
			  			<img id="categoryTip-img" src="designAssets/Illustration_Activity_Elephant.svg" style="width:100%">
			  		</div>
			  		<div id="categoryTip-text">Use filters to find events that fit your family's lifestyle</div>
			  		<button class='btn btn-secondary btn-block' id="categoryTip-done" onclick='makeCategoryCookie();'>Got It!</button>
				</div>

			</div>
		</div>
	</div>
	<!-- WalkTime Tip Modal -->
	<div id="walkTimeTip-layer">
		<div id="walkTimeTip-modal">
			<br>
			<div class="walkTimeTip-container">

				<div class="mySlides fade">
					<h4 id="walkTimeTip-title">Location, Location, Location</h4>
					<div style="display: flex">
			  			<img id="walkTimeTip-img" src="designAssets/Illustration_Directions_Elephant.svg" style="width:100%">
			  		</div>
			  		<div id="walkTimeTip-text">Move the slider to find events a quick walk away</div>
			  		<button class='btn btn-secondary btn-block' id="walkTimeTip-done" onclick='makeWalkTimeCookie();'>Got It!</button>
				</div>

			</div>
		</div>
	</div>
	<!-- ClosestEvent Tip Modal -->
	<div id="closestEventTip-layer">
		<div id="closestEventTip-modal">
			<br>
			<div class="closestEventTip-container">

				<div class="mySlides fade">
					<h4 id="closestEventTip-title">We're here to help!</h4>
			  		<div id="closestEventTip-text"><p>This feature finds the nearest event to your set location so you can take your kids out to burn off some energy!</p></div>
			  		<button class='btn btn-secondary btn-block' id="closestEventTip-done" onclick='makeClosestEventCookie();closestEventTip();'>Let's check it out!</button>
				</div>

			</div>
		</div>
	</div>

	<!-- Weather Modal -->
	<div id="weather-modal"></div>

	<!-- Settings Modal -->
	<div id="settings-modal"></div>

	<!-- Get Location Modal (Help Me Feature) -->
	<div id="warning-modal"></div>

	<!-- Infocard Modal -->
	<div id="events-modal" class="modal">
	  	<!-- Modal content -->
	  	<div class="modal-content">

	    	<div class="modal-header">
	    		<h2 id="modal-title"></h2>
	      		<span class="close" id="modal-close" onclick="hideModals();setZoom();">&times;</span>
	    	</div>
	    	<h5 id="scroll-notice">Scroll for more info</h5>
	    	<br>
	    	<div class="modal-body">
	    		<h5 id="modal-address"></h5>
	    		<h6 id="modal-walkTime"></h6>
	    		<div id="modal-directions"></div>
	    		<br>
	      		<p id="modal-description"></p>
	    	</div>

	  	</div>
	</div>

	<!-- Google maps -->
	<div id="map"></div>

	<script>
		function initialize() {
			initMap();
			initAutocomplete();
		}
		var map;
		var infoWindow;
		var pos, new_lat, new_lng, cur_lat, cur_lng, curLocation;
		var walkTime;
		var walkTimeLimit = 20;
		var curPosCnt = 0;
		var curPos = [];
		var eventMarkers = [];
		var isUserLocation = false;
		var directionsNow = false;
		var directionsService, directionsDisplay;
		var eventWalkTimes = [];
		var eventsToday = [];	 
	 	var dateObj = new Date();
		var year = dateObj.getUTCFullYear();
		var month = dateObj.getUTCMonth() + 1; //months from 1-12
		var day = dateObj.getUTCDate();

		var selectAll = true;
		var selectActive = false;
		var selectArts = false;
		var selectFamily = false;
		var selectFood = false;
		var selectFree = false;
		var selectMusic = false;
		var categoryColors = ['#6CC3D5','white','white','white','white','white','white'];
		var categoryTextColors = ['white','#6CC3D5','#6CC3D5','#6CC3D5','#6CC3D5','#6CC3D5','#6CC3D5'];
		var categoryIconColors = ["White", "Blue", "Blue", "Blue", "Blue", "Blue", "Blue"];

		//Get the modals for settings and warnings
		var weatherModal = document.getElementById('weather-modal');
		var settingsModal = document.getElementById('settings-modal');
		var warningModal = document.getElementById('warning-modal');
		settingsModal.style.display = "none";
		//Get the modal for infocards
		var modal = document.getElementById('events-modal');
		//Switch settings modals
		var isCategories = false;
		var isAges = false;
		var isWalkTime = false;
		var isFeatures = false;

		$(document).ready(function() {
			//Initialize onboarding modal
			$('#onboarding-layer').show();
	 		$('#onboarding-modal').show();
			//Location search bar
			$('#search-location').click(function() {
				hideModals();
				isCategories = false;
				isAges = false;
				isWalkTime = false;
				isFeatures = false;
				setTimeout(function () {
			        let viewheight = parseInt($(window).height(), 10);
			        let viewwidth = parseInt($(window).width(), 10);
			        let viewport = document.querySelector("meta[name=viewport]");
			        viewport.setAttribute("content", "height=" + viewheight + "px, width=" + viewwidth + "px, initial-scale=1.0");
			    }, 300);
			});
			$('#weather-btn').click(function() {
				$('#settings-modal').hide();
				$('#warning-modal').hide();
				isCategories = false;
				isAges = false;
				isWalkTime = false;
				isFeatures = false;
  				weatherModal.innerHTML = "<h3 style='text-align: center'>Sun's Out!</h3><div style='display: flex'><img id='weather-img-modal' src='designAssets/Illustration_Hot_Elephant.svg' style='width:100%'></div><button id='weather-check' class='btn btn-info btn-block' onclick='hideModals()'>Applied sunscreen</button>";
  				$('#weather-modal').toggle();
			});
			//Filter settings
			$('#categories').click(function() {
				categoryTip();
				settingsModal.innerHTML = initCategories(categoryColors[0],categoryTextColors[0],categoryColors[1],categoryTextColors[1],categoryColors[2],categoryTextColors[2],categoryColors[3],categoryTextColors[3],categoryColors[4],categoryTextColors[4],categoryColors[5],categoryTextColors[5],categoryColors[6],categoryTextColors[6]);
				//UX when closing settings taps
				$('#weather-modal').hide();
		    	$('#warning-modal').hide();
				if (isCategories == true) {
					isCategories = false;
					$('#settings-modal').hide();
				} else {
					isCategories = true;
					isAges = false;
					isWalkTime = false;
					isFeatures = false;
					$('#settings-modal').show();
				}
				
			});
			//Ages settings
		    $('#ages').click(function() {
		    	settingsModal.innerHTML = '<hr><div><h4>Feature Coming Soon!</h4><br></div>';
		    	//UX when closing settings taps
		    	$('#weather-modal').hide();
		    	$('#warning-modal').hide();
		    	if (isAges == true) {
					isAges = false;
					$('#settings-modal').hide();
				} else {
					isCategories = false;
					isAges = true;
					isWalkTime = false;
					isFeatures = false;
					$('#settings-modal').show();
				}
				
		    });
			//Walk time settings
		    $('#walk-time').click(function() {
		    	walkTimeTip();
		    	if (curLocation == undefined) {
		    		settingsModal.innerHTML = '<hr><div class="locationPrompt"><p>Find events within a certain walking distance from your location</p><button class="btn btn-info btn-block" onclick="getUserLocation()">Use my location!</button><br></div>';
		    	} else {
		    		settingsModal.innerHTML = '<hr><div class="slidecontainer"><input type="range" min="10" max="30" value="'+walkTimeLimit+'" class="slider" id="walkRangeSlider"><p>Walk Time: <span id="newWalkTime"></span> mins</p><button id="done-button" class="btn btn-info btn-block" onclick="hideModals()">Done!</button><br></div>';
		    		//Walk time slider
					var slider = document.getElementById("walkRangeSlider");
					var output = document.getElementById("newWalkTime");
					output.innerHTML = slider.value;
					slider.oninput = function() {
						output.innerHTML = this.value;
						walkTimeLimit = this.value;
						setZoom();
						if (cur_lat != undefined && cur_lng != undefined) {
							clearMarkers();
							updateFilter();
						}
					}
		    	}
		    	
				//UX when closing settings taps
				$('#weather-modal').hide();
		    	$('#warning-modal').hide();
				if (isWalkTime == true) {
					isWalkTime = false;
					$('#settings-modal').hide();
				} else {
					isCategories = false;
					isAges = false;
					isWalkTime = true;
					isFeatures = false;
					$('#settings-modal').show();
				}
				
		    });
		    //Additional features settings
		    $('#features').click(function() {
		    	settingsModal.innerHTML = '<hr><div><button id="help-me-button" class="btn btn-info btn-block" onclick="closestEventTip()">The kids are crazy. Help me!</button><br></div>';
		    	//UX when closing settings taps
		    	$('#weather-modal').hide();
		    	$('#warning-modal').hide();
		    	if (isFeatures == true) {
		    		isFeatures = false;
		    		$('#settings-modal').hide();
				} else {
					isCategories = false;
					isAges = false;
					isWalkTime = false;
					isFeatures = true;
					$('#settings-modal').show();
				}
				
		    });
		    //Close infocards
		    $('#modal-close').click(function() {
		    	setZoom();
		    	isCategories = false;
		    	isAges = false;
				isWalkTime = false;
				isFeatures = false;
		    	hideModals();
		    });
		});

		function userLocationControl(controlDiv, map) {
	        //Set CSS for the control border.
	        var controlUI = document.createElement('div');
	        controlUI.style.backgroundColor = '#fff';
	        controlUI.style.border = '2px solid #fff';
	        controlUI.style.borderRadius = '50%';
	        controlUI.style.boxShadow = '0 2px 6px rgba(0,0,0,.3)';
	        controlUI.style.cursor = 'pointer';
	        controlUI.style.marginBottom = '20px';
	        controlUI.style.marginRight = '20px';
	        controlUI.style.textAlign = 'center';
	        controlDiv.appendChild(controlUI);

	        //Set CSS for the control interior.
	        var controlText = document.createElement('div');
	        controlText.style.lineHeight = '40px';
	        controlText.style.paddingTop = '5px';
	        controlText.style.paddingLeft = '10px';
	        controlText.style.paddingBottom = '5px';
	        controlText.style.paddingRight = '10px';
	        controlText.innerHTML = '<img src="designAssets/GetLocation.png" height="30">';
	        controlUI.appendChild(controlText);

	        //Setup the click event listeners: get user location
	        controlUI.addEventListener('click', function() {
	        	directionsNow = false;
	          	getUserLocation();
	        });
	  	}

		function initMap() {
			//Default location: Toronto
			pos = {lat: 43.6532, lng: -79.3832};
			//Map options
			var options = {
				zoom: 14,
				center: pos,
				zoomControl: false,
				streetViewControl: false,
				mapTypeControl: false,
				fullscreenControl: false,
				styles: [{"featureType":"administrative","elementType":"labels.text.fill","stylers":[{"color":"#444444"}]},{"featureType":"landscape","elementType":"all","stylers":[{"color":"#f2f2f2"}]},{"featureType":"landscape.man_made","elementType":"geometry.fill","stylers":[{"visibility":"on"},{"color":"#eae9ed"}]},{"featureType":"landscape.natural.landcover","elementType":"geometry.fill","stylers":[{"visibility":"on"},{"color":"#d2e0b7"}]},{"featureType":"landscape.natural.terrain","elementType":"geometry","stylers":[{"visibility":"on"},{"color":"#d2e0b7"}]},{"featureType":"poi","elementType":"all","stylers":[{"visibility":"off"}]},{"featureType":"poi.park","elementType":"geometry.fill","stylers":[{"visibility":"on"}]},{"featureType":"road","elementType":"all","stylers":[{"saturation":-100},{"lightness":45}]},{"featureType":"road","elementType":"geometry.fill","stylers":[{"visibility":"on"},{"color":"#ffffff"}]},{"featureType":"road","elementType":"geometry.stroke","stylers":[{"visibility":"off"}]},{"featureType":"road","elementType":"labels.text.stroke","stylers":[{"visibility":"off"}]},{"featureType":"road.highway","elementType":"all","stylers":[{"visibility":"simplified"}]},{"featureType":"road.arterial","elementType":"labels.icon","stylers":[{"visibility":"off"}]},{"featureType":"transit","elementType":"all","stylers":[{"visibility":"off"}]},{"featureType":"water","elementType":"all","stylers":[{"color":"#b3dced"},{"visibility":"on"}]},{"featureType":"water","elementType":"labels.text.fill","stylers":[{"visibility":"on"},{"color":"#ffffff"}]},{"featureType":"water","elementType":"labels.text.stroke","stylers":[{"visibility":"off"},{"color":"#e6e6e6"}]}] //diluted blue: #b3dced, rich blue: #46bcec
			}
			//New map
			map = new google.maps.Map(document.getElementById('map'), options);
			infoWindow = new google.maps.InfoWindow;

			//Get user location button
	        var userLocationDIV = document.createElement('div');
	        var userControl = new userLocationControl(userLocationDIV, map);
	        userLocationDIV.index = 1;
	        map.controls[google.maps.ControlPosition.RIGHT_BOTTOM].push(userLocationDIV);

	        //Get search location results
			var searchLocationForm = document.getElementById('search-location-form');
			searchLocationForm.addEventListener('submit', geocodeSearch);

			//Closes infocards when map is clicked
			google.maps.event.addListener(map, "click", function(event) {
			    //clear directions
				directionsDisplay.set('directions', null);
				settingsModal.style.display = "none";
			});

			//Set up directions services
			directionsService = new google.maps.DirectionsService();
			directionsDisplay = new google.maps.DirectionsRenderer();
			directionsDisplay = new google.maps.DirectionsRenderer({
				suppressMarkers: true
			});
			directionsDisplay.setMap(map);

			//Get events happening today
			for (var i = 0; i < data.length; i++) {
			  	if (sameDate(data[i], year, month, day)) {
		    		eventsToday.push(data[i]);
			    }
			}
			//Init map with all events happening today
			for (var j = 0; j < eventsToday.length; j++) {
				addMarker({
					coords: {lat: eventsToday[j].lat, lng: eventsToday[j].lng},
					content: [eventsToday[j].name, eventsToday[j].address, -1, eventsToday[j].description],
					iconImage: "designAssets/EventPin.png"
				});
			}
			//When the user clicks anywhere outside of the infocard modal, close it
		    window.onclick = function(event) {
		    	if (event.target == modal) {
		    		isCategories = false;
					isAges = false;
					isWalkTime = false;
					isFeatures = false;
			    	setZoom();
			        modal.style.display = "none";
			    }
		    }
		    $('#map').click(function() {
		    	isCategories = false;
				isAges = false;
				isWalkTime = false;
				isFeatures = false;
		    });
	      			
	    }

		//HTML5 Geolocation (onboarding option #1)
		var walkingBuffer = 0.00032;
	    function getUserLocation() {
		    if (navigator.geolocation) {
		    	if (isUserLocation == false) {
		    		//Close all modals
		    		hideModals();
		    		//Get user location
		    		navigator.geolocation.getCurrentPosition(function(position) {
		          		new_lat = position.coords.latitude;
		          		new_lng = position.coords.longitude;
		            	pos = {
		             		lat: new_lat,
		              		lng: new_lng
		            	};
		            	//Move location marker when user moves (further than 20m away)
		            	if (((new_lat >= cur_lat+walkingBuffer) || (new_lat <= cur_lat-walkingBuffer) || (new_lng >= cur_lng+walkingBuffer) || (new_lng <= cur_lng-walkingBuffer)) || (cur_lat == undefined && cur_lng == undefined)) {
		            		if (curPosCnt > 0) {
			            		curPos[curPosCnt-1].setMap(null);
			            	}
			            	map.setCenter(pos);
			            	setZoom();
			            	curPosCnt += 1;
			            	cur_lat = new_lat;
			            	cur_lng = new_lng;
			            	isUserLocation = true;
		    				//Get address of current location
							reverseGeocode(cur_lat, cur_lng);
							setTimeout(() => {
							      	clearMarkers();
		    						updateFilter();
		    						//"Help Me" feature - finding nearest event
							      	if (directionsNow) {
							      		getClosestEvent();
							      		directionsNow = false;
							      	}
						    }, 2500);
						    addMarkerCurPos({
			            		coords: pos, 
			            		iconImage: "designAssets/UserPin.png"
			            	});
			            	//Clear text field
							document.getElementById('search-location').value = "";
		            	}
		          	});
		    	} else {
		    		//Re-center user location
		    		map.setCenter(pos);
			        setZoom();
		    	}
		    } else {
	          	//Browser doesn't support Geolocation
	          	handleLocationError(false, infoWindow, map.getCenter());
	        }
	        function handleLocationError(browserHasGeolocation, infoWindow, pos) {
	        	infoWindow.setPosition(pos);
	        	infoWindow.setContent(browserHasGeolocation ?
	                              'Error: The Geolocation service failed.' :
	                              'Error: Your browser doesn\'t support geolocation.');
	        	infoWindow.open(map);
	      	}
	    }
	    //Trigger location search (onboarding option #2)
	    function getSearchLocation() {
	    	//Close all modals
    		hideModals();
    		$("#search-location").trigger("select");
    		setTimeout(function () {
		        let viewheight = parseInt($(window).height(), 10);
		        let viewwidth = parseInt($(window).width(), 10);
		        let viewport = document.querySelector("meta[name=viewport]");
		        viewport.setAttribute("content", "height=" + viewheight + "px, width=" + viewwidth + "px, initial-scale=1.0");
		    }, 200);
	    }

		//Autocomplete address fields
		function initAutocomplete() {
			//var autocomplete = new google.maps.places.Autocomplete(document.getElementById('new-event-location'), {types: ['geocode']});
			var autocomplete = new google.maps.places.Autocomplete(document.getElementById('search-location'), {types: ['geocode']});
		}

		//***** Check for cookies *****
		//Check for category tip cookie
		function categoryTip() {
			var myCookie = getCookie("categoryTip"); //get cookie if it exists
		 	if (myCookie == null) { //no cookie exists yet, create one if requested
		 		$('#categoryTip-layer').show();
		 		$('#categoryTip-modal').show();
		 	}
		}
		//Check for walk time tip cookie
		function walkTimeTip() {
			var myCookie = getCookie("walkTimeTip"); //get cookie if it exists
		 	if (myCookie == null) { //no cookie exists yet, create one if requested
		 		$('#walkTimeTip-layer').show();
		 		$('#walkTimeTip-modal').show();
		 	}
		}
		//Check for "Help Me" tip cookie
		function closestEventTip() {
			directionsNow = true;
			var myCookie = getCookie("closestEventTip"); //get cookie if it exists
		 	if (myCookie == null) { //no cookie exists yet, create one if requested
		 		$('#closestEventTip-layer').show();
		 		$('#closestEventTip-modal').show();
		 	} else { //Help me feature functions
		 		//Need a location to proceed
	  			if (curLocation == undefined) {
	  				warningModal.innerHTML = "<span class='close' id='modal-close' onclick='hideModals()'>&times;</span><br><h3>Wait! Where are you?</h3><br><p>You can use your current location or input a direct address to find events in that area</p><br><br><button class='btn btn-info btn-block' onclick='getUserLocation()' id='use-my-location'>Use my location!</button>";
	  				hideModals();
	  				$('#warning-modal').show();
	  			}
	  			//Location is entered, proceed to getting closest event
	  			else {
	  				getClosestEvent();
	  			}
		 	}
		}
		//***** Create cookies *****
		//Create cookie to not show category tip again
	 	function makeCategoryCookie() { 
			//create cookie
		 	document.cookie = "categoryTip=Relevent_CategoryTip; expires=Fri, 30 Dec 2050 23:59:59 UTC";
		 	//close the modal dialog
		 	$('#categoryTip-layer').hide();
		 	$('#categoryTip-modal').hide();
		}
		//Create cookie to not show walk time tip again
	 	function makeWalkTimeCookie() { 
			//create cookie
		 	document.cookie = "walkTimeTip=Relevent_WalkTimeTip; expires=Fri, 30 Dec 2050 23:59:59 UTC";
		 	//close the modal dialog
		 	$('#walkTimeTip-layer').hide();
		 	$('#walkTimeTip-modal').hide();
		}
		//Create cookie to not show "Help Me" tip again
	 	function makeClosestEventCookie() { 
			//create cookie
		 	document.cookie = "closestEventTip=Relevent_ClosestEventTip; expires=Fri, 30 Dec 2050 23:59:59 UTC";
		 	//close the modal dialog
		 	$('#closestEventTip-layer').hide();
		 	$('#closestEventTip-modal').hide();
		}
		//Checks if cookies exists
		function getCookie(name) { 
		 	var dc = document.cookie;
		 	var prefix = name +"=";
		 	var begin = dc.indexOf("; " + prefix);
		 	if (begin == -1) //cookie doesnâ€™t exist yet
		 	{
		 		begin = dc.indexOf(prefix);
		 		if (begin != 0) return null;
		 	}
		 	else //cookie does exist
		 	{
		 		begin += 2;
		 		var end = document.cookie.indexOf(";", begin);
		 		if (end == -1) {
		 			end = dc.length;
		 		}
		 	}
		 	return decodeURI(dc.substring(begin + prefix.length, end));
		}
		
	    //Add current position marker
		function addMarkerCurPos(properties) {
			var marker = new google.maps.Marker({
				position: properties.coords,
				map: map,
				icon: properties.iconImage
			});
			curPos.push(marker);
		}

		//Attributes for event modals
		var modalTitle = document.getElementById('modal-title');
		var modalAddr = document.getElementById('modal-address');
		var modalWalkTime = document.getElementById('modal-walkTime');
		var modalDirections = document.getElementById('modal-directions');
		var modalDesc = document.getElementById('modal-description');

		//Add event marker
		function addMarker(properties) {
			var marker = new google.maps.Marker({
				position: properties.coords,
				map: map
			});
			//Check for custom icons
			if (properties.iconImage) {
				marker.setIcon(properties.iconImage);
			}
			//Check for content
			if (properties.content) {
				marker.addListener('click', function() {
					map.setZoom(16);
					//Create offset to make room for events modal
					var offsetY = properties.coords.lat - (0.00031*5);
					map.panTo({lat: offsetY, lng: properties.coords.lng});
					modalTitle.innerHTML = properties.content[0]
					modalAddr.innerHTML = properties.content[1];
					//Location submitted, can get event walk times
					if (properties.content[2] != -1) {
						modalWalkTime.innerHTML = "Walk Time: " + properties.content[2] + " mins";
					}
					if (curLocation != undefined) {
						modalDirections.innerHTML = '<button class="btn btn-warning btn-block" onclick="getDirections(\'' + curLocation + '\',\'' + properties.content[1] + '\')">View Walking Path</button>';
					}
					modalDesc.innerHTML = properties.content[3];
					hideModals();
					modal.style.display = "block";
					
				});
			}
			eventMarkers.push(marker);
		}

		//Clear all eventMarkers from map
      	function clearMarkers(map) {
	        for (var i = 0; i < eventMarkers.length; i++) {
	          	eventMarkers[i].setMap(map);
        	}
        	eventMarkers = [];
  		}

  		//Get nearest event for "Help Me" feature
  		var nearestEventNum;
  		//Update map with events that are within walking distance
  		function getEvents(events) {
  			var nearestEventWalkTime = 1000;
  			var nearestEventTemp = 0;

  			for (var i = 0; i < events.length; i++) {
  				eventWalkTimes[i] = calculateWalkTime(cur_lat, cur_lng, events[i].lat, events[i].lng);
  				//No location submitted
  				if (isNaN(eventWalkTimes[i])) {
  					addMarker({
						coords: {lat: events[i].lat, lng: events[i].lng},
						content: [events[i].name, events[i].address, -1, events[i].description],
						iconImage: "designAssets/EventPin.png"
					});
  				} 
  				//Location submitted
  				else if (eventWalkTimes[i] <= walkTimeLimit) {
  					nearestEventTemp++;
  					addMarker({
						coords: {lat: events[i].lat, lng: events[i].lng},
						content: [events[i].name, events[i].address, eventWalkTimes[i], events[i].description],
						iconImage: "designAssets/EventPin.png"
					});
  					//get nearest event to user
  					if (eventWalkTimes[i] < nearestEventWalkTime) {
  						nearestEventWalkTime = eventWalkTimes[i];
  						nearestEventNum = nearestEventTemp;
  					}
  					
  				}
		  	}
  		}

  		function getClosestEvent() {
  			//Close warning modal
		    $('#warning-modal').hide();
		    //Select nearest event marker
		    google.maps.event.trigger(eventMarkers[nearestEventNum-1], 'click');
  		}

  		//Close the onboarding and warning modals
  		function hideModals() {
  			isCategories = false;
			isAges = false;
			isWalkTime = false;
			isFeatures = false;
  			$('#weather-modal').hide();
  			$('#settings-modal').hide();
  			$('#warning-modal').hide();
  			$('#onboarding-layer').hide();
  			$('#categoryTip-modal').hide();
  			$('#categoryTip-layer').hide();
  			$('#onboarding-modal').hide();
  			$('#events-modal').hide();
  		}

  		//Convert addr to lat,lng - center search result
  		function geocodeSearch(e) {
			e.preventDefault();

			var geocoder = new google.maps.Geocoder();
			curLocation = document.getElementById('search-location').value;

			geocoder.geocode( { 'address': curLocation}, function(results, status) {

				if (status == google.maps.GeocoderStatus.OK) {
				    var new_lat = results[0].geometry.location.lat();
					var new_lng = results[0].geometry.location.lng();
					pos = {
	             		lat: new_lat,
	              		lng: new_lng
	            	};
	        		if (curPosCnt > 0) {
	            		curPos[curPosCnt-1].setMap(null);
	            	}
	        		addMarkerCurPos({
	            		coords: pos, 
	            		iconImage: "designAssets/SearchPin.png"
	            	});
	            	map.setCenter(pos);
	            	setZoom();
	            	curPosCnt += 1;
	            	cur_lat = new_lat;
	            	cur_lng = new_lng;
	            	isUserLocation = false;
	            	clearMarkers();
					updateFilter();
					//Clear text field
					document.getElementById('search-location').value = "";
			    } 
			}); 
			
		}

		//Convert lat,lng to address
		function reverseGeocode(cur_lat, cur_lng) {
			$.ajax({url: "https://maps.googleapis.com/maps/api/geocode/json?latlng="+cur_lat+","+cur_lng+"&sensor=false", success: function(result) {
				curLocation = result.results[0].formatted_address;
			}});
		}

		//Set map zoom based on walk time setting
		function setZoom() {
			if (walkTimeLimit > 25 && walkTimeLimit <= 30) {
				map.setZoom(13);
			} else if (walkTimeLimit > 15 && walkTimeLimit <= 25) {
				map.setZoom(14);
			} else {
				map.setZoom(15);
			}
		}	

		var R = 6378137; //Radius of the Earth in meters
		var dLat, dLng, a, c;
		//Calculate distance between user and event
		function calculateWalkTime(cur_lat, cur_lng, event_lat, event_lng) {
			// return Math.ceil((google.maps.geometry.spherical.computeDistanceBetween(new google.maps.LatLng(cur_lat, cur_lng), new google.maps.LatLng(event_lat, event_lng)))/80);
		    dLat = event_lat * Math.PI / 180 - cur_lat * Math.PI / 180;
		    dLng = event_lng * Math.PI / 180 - cur_lng * Math.PI / 180;
		    a = Math.sin(dLat/2) * Math.sin(dLat/2) + Math.cos(cur_lat * Math.PI / 180) * Math.cos(event_lat * Math.PI / 180) * Math.sin(dLng/2) * Math.sin(dLng/2);
		    c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
		    return Math.ceil((R*c)/80);
		}

		//get directions from user to event
		function getDirections(curLocation, eventLocation) {
			directionsService.route({
	          	origin: curLocation,
	          	destination: eventLocation,
	          	travelMode: 'WALKING'
	        }, function(response, status) {
	          	if (status === 'OK') {
	            	directionsDisplay.setDirections(response);
	            	modal.style.display = "none";
	          	} else {
	            	window.alert('Directions request failed due to ' + status);
	          	}
	        });
		}

		var date, target, stringDates, splitted;
		//Return true if an event is happening on a given date.
		function sameDate(event, year, month, day) {
			date = convertDates(event);
			target = [year, month, day];
			for (var i = 0; i < date.length; i++) {
				if (equalDates(date[i], target)) {
					return true;
				}
			}
			return false;
		}
		function equalDates(date1, date2) {
			return date1[0] == date2[0] && date1[1] == date2[1] && date1[2] == date2[2];
		}
		//Convert all the dates of an event from string format to an array of integers.
		function convertDates(event) {
			stringDates = event.dates;
		  	var dates = []//Converted dates, where each date is an array of integers.
		  	for (var i = 0; i < stringDates.length; i++) {
		  		dates.push(convertDate(stringDates[i]));
		  	}
		  	return dates;
		}
		// Event dates are stored as a string. Converting it to an array of integers makes it easier to handle.
		function convertDate(dateString) {
			splitted = dateString.split("-");
			year = parseInt(splitted[0]);
			month = parseInt(splitted[1]);
			day = parseInt(splitted[2]);
			return [year, month, day];
		}
		//Initialize filters setting
		function initCategories(allBtn,allTxt,activeBtn,activeTxt,artsBtn,artsTxt,familyBtn,familyTxt,foodBtn,foodTxt,freeBtn,freeTxt,musicBtn,musicTxt) {
			return '<div class="container-fluid">' +
				'<div class="items-collection"><hr>' +
					'<div class="row">' +
						'<div class="items col-6 col-md-3">' +
                            '<button class="btn btn-block" style="background-color:'+allBtn+'" id="select-all" onclick="updateAll()">' +
                            		'<img id="category-icons" src="designAssets/All_Icon_'+categoryIconColors[0]+'.svg">' +
                                    '<h6 id="text-all" style="color:'+allTxt+'">All</h6>' +
                            '</button>' +
						'</div>' +
						'<div class="items col-6 col-md-3">' +
                            '<button class="btn btn-block" style="background-color:'+activeBtn+'" id="select-active" onclick="updateActive()">' +
                            		'<img id="category-icons" src="designAssets/Active_Icon_'+categoryIconColors[1]+'.svg">' +
                                    '<h6 id="text-active" style="color:'+activeTxt+'">Active</h6>' +
                            '</button>' +
						'</div>' +
						'<div class="items col-6 col-md-3">' +
                            '<button class="btn btn-block" style="background-color:'+artsBtn+'" id="select-arts" onclick="updateArts()">' +
                            		'<img id="category-icons" src="designAssets/Arts_Icon_'+categoryIconColors[2]+'.svg">' +
                                    '<h6 id="text-arts" style="color:'+artsTxt+'">Arts</h6>' +
                            '</button>' +
						'</div>' +
						'<div class="items col-6 col-md-3">' +
                            '<button class="btn btn-block" style="background-color:'+familyBtn+'" id="select-family" onclick="updateFamily()">' +
                            		'<img id="category-icons" src="designAssets/Family_Icon_'+categoryIconColors[3]+'.svg">' +
                                    '<h6 id="text-family" style="color:'+familyTxt+'">Family</h6>' +
                            '</button>' +
						'</div>' +
						'<div class="items col-6 col-md-3">' +
                            '<button class="btn btn-block" style="background-color:'+foodBtn+'" id="select-food" onclick="updateFood()">' +
                            		'<img id="category-icons" src="designAssets/Food_Icon_'+categoryIconColors[4]+'.svg">' +
                                    '<h6 id="text-food" style="color:'+foodTxt+'">Food</h6>' +
                            '</button>' +
						'</div>' +
						'<div class="items col-6 col-md-3">' +
                            '<button class="btn btn-block" style="background-color:'+freeBtn+'" id="select-free" onclick="updateFree()">' +
                            		'<img id="category-icons" src="designAssets/Free_Icon_'+categoryIconColors[5]+'.svg">' +
                                    '<h6 id="text-free" style="color:'+freeTxt+'">Free</h6>' +
                            '</button>' +
						'</div>' +
						'<div class="items col-6 col-md-3">' +
                            '<button class="btn btn-block" style="background-color:'+musicBtn+'" id="select-music" onclick="updateMusic()">' +
                            		'<img id="category-icons" src="designAssets/Music_Icon_'+categoryIconColors[6]+'.svg">' +
                                    '<h6 id="text-music" style="color:'+musicTxt+'">Music</h6>' +
                            '</button>' +
						'</div>' +
					'</div>' +
					'<br><button id="done-button" class="btn btn-info btn-block" onclick="hideModals()">Done!</button>' +
				'</div>' +
			'</div><br>';
		}
		//If all event types clicked, become "All"
		function isUpdateAll() {
			if (selectActive && selectArts && selectFamily && selectFood && selectFree && selectMusic) {
				var selectBox = document.getElementById('select-all');
				var text = document.getElementById('text-all');
				selectAll = true;
				selectActive = false;
				selectArts = false;
				selectFamily = false;
				selectFood = false;
				selectFree = false;
				selectMusic = false;
				categoryColors[0] = '#6CC3D5';
				categoryTextColors[0] = 'white';
				for (var i=1; i<=6; i++) {
					categoryColors[i] = 'white';
					categoryTextColors[i] = '#6CC3D5';
				}
				selectBox.style.backgroundColor = "#6CC3D5";
				document.getElementById('select-active').style.backgroundColor = "white";
				document.getElementById('select-arts').style.backgroundColor = "white";
				document.getElementById('select-family').style.backgroundColor = "white";
				document.getElementById('select-food').style.backgroundColor = "white";
				document.getElementById('select-free').style.backgroundColor = "white";
				document.getElementById('select-music').style.backgroundColor = "white";
				text.style.color = "white";
				document.getElementById('text-active').style.color = "#6CC3D5";
				document.getElementById('text-arts').style.color = "#6CC3D5";
				document.getElementById('text-family').style.color = "#6CC3D5";
				document.getElementById('text-free').style.color = "#6CC3D5";
				document.getElementById('text-food').style.color = "#6CC3D5";
				document.getElementById('text-music').style.color = "#6CC3D5";
				settingsModal.innerHTML = settingsModal.innerHTML.replace('All_Icon_Blue.svg', 'All_Icon_White.svg');
				settingsModal.innerHTML = settingsModal.innerHTML.replace('Active_Icon_White.svg', 'Active_Icon_Blue.svg');
				settingsModal.innerHTML = settingsModal.innerHTML.replace('Arts_Icon_White.svg', 'Arts_Icon_Blue.svg');
				settingsModal.innerHTML = settingsModal.innerHTML.replace('Family_Icon_White.svg', 'Family_Icon_Blue.svg');
				settingsModal.innerHTML = settingsModal.innerHTML.replace('Food_Icon_White.svg', 'Food_Icon_Blue.svg');
				settingsModal.innerHTML = settingsModal.innerHTML.replace('Free_Icon_White.svg', 'Free_Icon_Blue.svg');
				settingsModal.innerHTML = settingsModal.innerHTML.replace('Music_Icon_White.svg', 'Music_Icon_Blue.svg');
			}
			//Change category icons when selected
			for (var j=0; j<=6; j++) {
				if (categoryTextColors[j] == "#6CC3D5") {
					categoryIconColors[j] = "Blue";
				} else if (categoryTextColors[j] == "white") {
					categoryIconColors[j] = "White";
				}
			}
			clearMarkers();
			updateFilter();
		}
		function updateAll() {
			if (!selectAll) {
				//Toggle on
				selectAll = true;
				//Temporarily set every category to true for isUpdateAll();
				selectActive = true;
				selectArts = true;
				selectFamily = true;
				selectFood = true;
				selectFree = true;
				selectMusic = true;
				isUpdateAll();
			}
		}
		function updateActive() {
			var selectBox = document.getElementById('select-active');
			var text = document.getElementById('text-active');
			if (selectActive) {
				//Toggle off only if other categories are active
				if (selectArts || selectFamily || selectFood || selectFree || selectMusic) {
					categoryColors[1] = 'white';
					categoryTextColors[1] = '#6CC3D5';
					selectBox.style.backgroundColor = "white";
					text.style.color = "#6CC3D5";
					selectActive = false;
					settingsModal.innerHTML = settingsModal.innerHTML.replace('Active_Icon_White.svg', 'Active_Icon_Blue.svg');
				} else { 
					selectActive = true; 
				}
			} else {
				//Toggle on
				selectAll = false;
				categoryColors[0] = 'white';
				categoryColors[1] = '#6CC3D5';
				categoryTextColors[0] = '#6CC3D5';
				categoryTextColors[1] = 'white';
				selectBox.style.backgroundColor = "#6CC3D5";
				document.getElementById('select-all').style.backgroundColor = "white";
				text.style.color = "white";
				document.getElementById('text-all').style.color = "#6CC3D5";
				selectActive = true;
				settingsModal.innerHTML = settingsModal.innerHTML.replace('Active_Icon_Blue.svg', 'Active_Icon_White.svg');
				settingsModal.innerHTML = settingsModal.innerHTML.replace('All_Icon_White.svg', 'All_Icon_Blue.svg');
			}
			isUpdateAll();
		}
		function updateArts() {
			var selectBox = document.getElementById('select-arts');
			var text = document.getElementById('text-arts');
			if (selectArts) {
				//Toggle off only if other categories are active
				if (selectActive || selectFamily || selectFood || selectFree || selectMusic) {
					categoryColors[2] = 'white';
					categoryTextColors[2] = '#6CC3D5';
					selectBox.style.backgroundColor = "white";
					text.style.color = "#6CC3D5";
					selectArts = false;
					settingsModal.innerHTML = settingsModal.innerHTML.replace('Arts_Icon_White.svg', 'Arts_Icon_Blue.svg');
				} else { 
					selectArts = true; 
				}
			} else {
				//Toggle on
				selectAll = false;
				categoryColors[0] = 'white';
				categoryColors[2] = '#6CC3D5';
				categoryTextColors[0] = '#6CC3D5';
				categoryTextColors[2] = 'white';
				selectBox.style.backgroundColor = "#6CC3D5";
				document.getElementById('select-all').style.backgroundColor = "white";
				text.style.color = "white";
				document.getElementById('text-all').style.color = "#6CC3D5";
				selectArts = true;
				settingsModal.innerHTML = settingsModal.innerHTML.replace('Arts_Icon_Blue.svg', 'Arts_Icon_White.svg');
				settingsModal.innerHTML = settingsModal.innerHTML.replace('All_Icon_White.svg', 'All_Icon_Blue.svg');
			}
			isUpdateAll();
		}
		function updateFamily() {
			var selectBox = document.getElementById('select-family');
			var text = document.getElementById('text-family');
			if (selectFamily) {
				//Toggle off only if other categories are active
				if (selectActive || selectArts || selectFood || selectFree || selectMusic) {
					categoryColors[3] = 'white';
					categoryTextColors[3] = '#6CC3D5';
					selectBox.style.backgroundColor = "white";
					text.style.color = "#6CC3D5";
					selectFamily = false;
					settingsModal.innerHTML = settingsModal.innerHTML.replace('Family_Icon_White.svg', 'Family_Icon_Blue.svg');
				} else { 
					selectFamily = true; 
				}
			} else {
				//Toggle on
				selectAll = false;
				categoryColors[0] = 'white';
				categoryColors[3] = '#6CC3D5';
				categoryTextColors[0] = '#6CC3D5';
				categoryTextColors[3] = 'white';
				selectBox.style.backgroundColor = "#6CC3D5";
				document.getElementById('select-all').style.backgroundColor = "white";
				text.style.color = "white";
				document.getElementById('text-all').style.color = "#6CC3D5";
				selectFamily = true;
				settingsModal.innerHTML = settingsModal.innerHTML.replace('Family_Icon_Blue.svg', 'Family_Icon_White.svg');
				settingsModal.innerHTML = settingsModal.innerHTML.replace('All_Icon_White.svg', 'All_Icon_Blue.svg');
			}
			isUpdateAll();
		}
		function updateFood() {
			var selectBox = document.getElementById('select-food');
			var text = document.getElementById('text-food');
			if (selectFood) {
				//Toggle off only if other categories are active
				if (selectActive || selectArts || selectFamily || selectFree || selectMusic) {
					categoryColors[4] = 'white';
					categoryTextColors[4] = '#6CC3D5';
					selectBox.style.backgroundColor = "white";
					text.style.color = "#6CC3D5";
					selectFood = false;
					settingsModal.innerHTML = settingsModal.innerHTML.replace('Food_Icon_White.svg', 'Food_Icon_Blue.svg');
				} else { 
					selectFood = true; 
				}
			} else {
				//Toggle on
				selectAll = false;
				categoryColors[0] = 'white';
				categoryColors[4] = '#6CC3D5';
				categoryTextColors[0] = '#6CC3D5';
				categoryTextColors[4] = 'white';
				selectBox.style.backgroundColor = "#6CC3D5";
				document.getElementById('select-all').style.backgroundColor = "white";
				text.style.color = "white";
				document.getElementById('text-all').style.color = "#6CC3D5";
				selectFood = true;
				settingsModal.innerHTML = settingsModal.innerHTML.replace('Food_Icon_Blue.svg', 'Food_Icon_White.svg');
				settingsModal.innerHTML = settingsModal.innerHTML.replace('All_Icon_White.svg', 'All_Icon_Blue.svg');
			}
			isUpdateAll();
		}
		function updateFree() {
			var selectBox = document.getElementById('select-free');
			var text = document.getElementById('text-free');
			if (selectFree) {
				//Toggle off only if other categories are active
				if (selectActive || selectArts || selectFamily || selectFood || selectMusic) {
					categoryColors[5] = 'white';
					categoryTextColors[5] = '#6CC3D5';
					selectBox.style.backgroundColor = "white";
					text.style.color = "#6CC3D5";
					selectFree = false;
					settingsModal.innerHTML = settingsModal.innerHTML.replace('Free_Icon_White.svg', 'Free_Icon_Blue.svg');
				} else { 
					selectFree = true; 
				}
			} else {
				//Toggle on
				selectAll = false;
				categoryColors[0] = 'white';
				categoryColors[5] = '#6CC3D5';
				categoryTextColors[0] = '#6CC3D5';
				categoryTextColors[5] = 'white';
				selectBox.style.backgroundColor = "#6CC3D5";
				document.getElementById('select-all').style.backgroundColor = "white";
				text.style.color = "white";
				document.getElementById('text-all').style.color = "#6CC3D5";
				selectFree = true;
				settingsModal.innerHTML = settingsModal.innerHTML.replace('Free_Icon_Blue.svg', 'Free_Icon_White.svg');
				settingsModal.innerHTML = settingsModal.innerHTML.replace('All_Icon_White.svg', 'All_Icon_Blue.svg');
			}
			isUpdateAll();
		}
		function updateMusic() {
			var selectBox = document.getElementById('select-music');
			var text = document.getElementById('text-music');
			if (selectMusic) {
				//Toggle off only if other categories are active
				if (selectActive || selectArts || selectFamily || selectFood || selectFree) {
					categoryColors[6] = 'white';
					categoryTextColors[6] = '#6CC3D5';
					selectBox.style.backgroundColor = "white";
					text.style.color = "#6CC3D5";
					selectMusic = false;
					settingsModal.innerHTML = settingsModal.innerHTML.replace('Music_Icon_White.svg', 'Music_Icon_Blue.svg');
				} else { 
					selectMusic = true; 
				}
			} else {
				//Toggle on
				selectAll = false;
				categoryColors[0] = 'white';
				categoryColors[6] = '#6CC3D5';
				categoryTextColors[0] = '#6CC3D5';
				categoryTextColors[6] = 'white';
				selectBox.style.backgroundColor = "#6CC3D5";
				document.getElementById('select-all').style.backgroundColor = "white";
				text.style.color = "white";
				document.getElementById('text-all').style.color = "#6CC3D5";
				selectMusic = true;
				settingsModal.innerHTML = settingsModal.innerHTML.replace('Music_Icon_Blue.svg', 'Music_Icon_White.svg');
				settingsModal.innerHTML = settingsModal.innerHTML.replace('All_Icon_White.svg', 'All_Icon_Blue.svg');
			}
			isUpdateAll();
		}

		//Update events that appear
		function updateFilter() {
			if (selectAll) {
				getEvents(eventsToday);
				return;
			}
			var categories = [];
			if (selectActive) {
				categories.push("Active");
			} if (selectArts) {
				categories.push("Arts & Culture");
			} if (selectFamily) {
				categories.push("Family");
			} if (selectFood) {
				categories.push("Food");
			} if (selectMusic) {
				categories.push("Music");
			}
			//Get events that have specific category tags selected
			var filteredEvents = filter(eventsToday, categories);
			getEvents(filteredEvents);
		}

		//Mapping of all event categories to UI categories
		var categoryMap = {
			"free" : null,
  			"Family" : ["Family/Children"],
			"Arts & Culture" : ["History", "Museum", "Arts/Exhibit", "Theater", "Film"],
			"Food" : ["Food/Culinary", "Farmers Market"],
			"Active" : ["Walking", "Running", "Cycling", "Sports"],
			"Music" : ["Live Performances", "Music"]
		};
		Object.freeze(filter);

		// Filter an array of events by an array of categories. Returns an array.
		function filter(events, categories) {
			var filteredEvents = [];
			var allSubcategories = getSubcategories(categories);
  			var free = categories.includes("free");
    
  			for (var i = 0; i < events.length; i++) {
  				event = events[i];
  				if (free && event["free"] == "Yes") {
    				filteredEvents.push(event);
      				continue;
    			}

				mySubcategories = event["category"];
    
    			for (var j = 0; j < mySubcategories.length; j++) {
    				subcategory = mySubcategories[j];
					if (allSubcategories.includes(subcategory)) {
      					filteredEvents.push(event);
        				continue;
      				}
    			}  
  			}
  			return filteredEvents;
		}

		// Get all the subcategories from the category map. The categories parameter should be an array.
		function getSubcategories(categories) {
			var allSubcategories = [];
  			for (var i = 0; i < categories.length; i++) {
  				category = categories[i];
    
    			if (!categoryMap.hasOwnProperty(category)) {
    				throw "The category " + category + " does not exist in the category map.";
    			}
			    if (category == "free") {
			    	continue;
			    }
    
			    var subcategories = categoryMap[category];
			    allSubcategories.push.apply(subcategories);
			    
			    for (var j = 0; j < subcategories.length; j++) {
			    	allSubcategories.push(subcategories[j]);
			    }
		  	}
			return allSubcategories;
		}


	</script>

	<script async defer
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBLcLmEXKhLUdhDY8RiQyu24dCuw592G-c&libraries=places,geometry&callback=initialize">
    </script>
</body>

</html>